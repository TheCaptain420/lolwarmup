<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>LoL Warm Up</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
</head>

<body>
    <h3 id="title">LEAGUE OF LEGENDS WARMUP</h3> <button onclick="endGametime=250">Quick</button> <button onclick="endGametime=500">Long</button>


    <canvas id="gameCanvas" width="1500" height="650"></canvas>
    <script>

        //Laver Canvas
        var canvas;
        var canvasContext;
        //score
        var playerScore = 0;
        var highScore = 0;
        //Om den skal vise win screen eller ej
        var showingWinScreen = true;

        //Udregner mus position
        function calculateMousePos(evt) {
            var rect = canvas.getBoundingClientRect();
            var root = document.documentElement;
            var mouseX = evt.clientX - rect.left - root.scrollLeft;
            var mouseY = evt.clientY - rect.top - root.scrollTop;
            return {
                x: mouseX,
                y: mouseY
            };
        }

        var twice = 0
        //Hander Mus click
        function handleMouseClick(evt) {
            //andet kode her
            //If inden for circle, få points + fjern circle
            var mousePos = calculateMousePos(evt);

            if ((posholdWidth - ((timer % difficulty))) < mousePos.x && mousePos.x < (posholdWidth + ((timer % difficulty)))) {
                if ((posholdHeight - ((timer % difficulty))) < mousePos.y && mousePos.y < (posholdHeight + ((timer % difficulty)))) {
                    playerScore += (difficulty - timer % difficulty);
                    timer = difficulty;
                }
            } else {
                if (!showingWinScreen) {
                    playerScore -= 5;
                }
            }


            //hvis spillet er færdig og du vil prøve igen.
            if (showingWinScreen) {
                twice++;
                if (twice == 2) {
                    //resetter alt
                    playerScore = 0;
                    showingWinScreen = false;
                    twice = 0;
                    gametime = 0;
                    timer = 0
                }
            }
        }

        var currentLetter = "q";
     

        function handleButtonClick(evt) {
        //q = 113, w= 119, e=101, r= 114.
            
            if(evt.which == 113){
                //q
                if(currentLetter == "Q"){
                    playerScore+=Math.floor(difficulty-(letterTimer % difficulty)); ;
                    letterTimer=difficulty*2;
                }else{
                    playerScore-=20;
                }
            }else if(evt.which == 119){
                //w
                if(currentLetter == "W"){
                    playerScore+=Math.floor(difficulty-(letterTimer % difficulty)); ;
                    letterTimer=difficulty*2;
                }else{
                    playerScore-=20;
                }
            }else if(evt.which == 101){
                //e
                if(currentLetter == "E"){
                    playerScore+=Math.floor(difficulty-(letterTimer % difficulty)); ;
                    letterTimer=difficulty*2;
                }else{
                    playerScore-=20;
                }
            } else if(evt.which == 114){
                //r
                if(currentLetter == "R"){
                    playerScore+=Math.floor(difficulty-(letterTimer % difficulty)); ;
                    letterTimer=difficulty*2;
                }else{
                    playerScore-=20;
                }
            }  




        }


        //"animationerne" og arbejde med canvas
        //onload starter functionen ligeså snart siden starter
        window.onload = function () {
            //instantiere canvas
            canvas = document.getElementById("gameCanvas");
            canvasContext = canvas.getContext("2d");
            canvasContext.font = "bold 40px ubuntu";
            // kører move og draw, 30 gange i sec.
            var framesPerSecond = 30;
            setInterval(function () {
                moveEverything();
                drawEverything();
            }, 1000 / framesPerSecond);

            canvas.addEventListener("mousedown", handleMouseClick);
            window.addEventListener("keypress", handleButtonClick);
            //Henter mus pos
            canvas.addEventListener("mousemove",
                function (evt) {
                    var mousePos = calculateMousePos(evt);
                    //paddle1Y = mousePos.y - (PADDLE_HEIGHT / 2);
                });
        }


        function moveEverything() {
            //Hvis den viser winscreen skal den ikke køre resten
            if (showingWinScreen) {
                return;
            }

            if (gametime > endGametime) {

                showingWinScreen = true;

                if (playerScore>highScore){
                    highScore=playerScore;
                    document.getElementById("title").innerHTML = "LEAGUE OF LEGENDS WARMUP - Highscore: "+highScore; 
                }
            }

        }

        //tegner stregen(stregerne) der går ned igennem.
        function drawNet() {
            for (var k = 150; k < canvas.width; k += 150) {
                for (var i = 0; i < canvas.height; i += 40) {
                    colorRect(k, i, 1, 20, "white");

                    //colorRect(canvas.width / 2 - 1, i, 2, 20, "white");
                }
            }
        }

        function drawEverything() {
            //Tegner via canvas funktioner
            //background
            colorRect(0, 0, canvas.width, canvas.height, "black");
            //Win Screen
            if (showingWinScreen) {
                canvasContext.fillStyle = "white";

                canvasContext.fillText("Score = " + playerScore + " Click to play again", 50, 50)
                return;
            }
            //Streger ned igennem
            drawNet();
            spawnRandomCircle();
            spawnRandomLetter();
            timer++;
            letterTimer++;
            gametime++;
            //The Score
            
            canvasContext.font = "bold 20px ubuntu";
            canvasContext.fillStyle = "white";
            canvasContext.fillText("Time = " + (endGametime-gametime) , 20, 40)
            canvasContext.fillText("Score = " + playerScore , 20, 65)

            //canvasContext.fillText(player1Score, 100, 100);
            //canvasContext.fillText(player2Score, canvas.width - 100, 100);
        }

        var posholdWidth = 100;
        var posholdHeight = 100;
        var difficulty = 50;
        var timer = 0;
        var letterTimer = 0;
        var gametime = 0;
        var endGametime = 250;
        

        function spawnRandomCircle() {
            var ranPosWidth = Math.floor((Math.random() * canvas.width) + 1);
            var ranPosHeight = Math.floor((Math.random() * canvas.height) + 1);


            var sizeRadius = timer % difficulty;
            var color = "red";

            if (timer % difficulty == 0) {
                posholdHeight = ranPosHeight;
                posholdWidth = ranPosWidth;
            }


            colorCircle(posholdWidth, posholdHeight, sizeRadius, color);


        }

        var posholdWidthText = 100;
        var posholdHeightText = 100;

        function spawnRandomLetter() {
            var ranPosWidthText = Math.floor((Math.random() * canvas.width) + 1);
            var ranPosHeightText = Math.floor((Math.random() * canvas.height) + 1);


            var sizePX = letterTimer % difficulty;
            var color = "red";

            if (letterTimer % (difficulty*2) == 0) {
                posholdHeightText = ranPosHeightText;
                posholdWidthText = ranPosWidthText;
                letterRandoGenerator();
            }

            

            colorLetter(currentLetter,sizePX,posholdWidthText,posholdHeightText);


        }

        //bruger canvas funks, til at tegne+farve en cirkel.
        function colorCircle(centerX, centerY, radius, drawColor) {
            //ball
            canvasContext.fillStyle = drawColor;
            canvasContext.beginPath();
            canvasContext.arc(centerX, centerY, radius, 0, Math.PI * 2, true);
            canvasContext.fill();
        }

        //bruger canvas funks, til at tegne+farve en rect.
        function colorRect(leftX, topY, width, height, drawColor) {
            canvasContext.fillStyle = drawColor;
            canvasContext.fillRect(leftX, topY, width, height);
        }

        //Letter
        function colorLetter(letter, size, width,  height){
            
            canvasContext.font = "bold "+size+"px ubuntu";
            canvasContext.fillStyle = "red";
            canvasContext.fillText(""+letter+"",width,height)


        }

        //letter gen
        function letterRandoGenerator(){
            //4 letters
            var letterChooser=Math.floor((Math.random() * 4) + 1)
            if(letterChooser==1){
                currentLetter ="Q"
            }else if(letterChooser==2){
                currentLetter ="W"
            }else if(letterChooser==3){
                currentLetter ="E"
            }else if(letterChooser==4){
                currentLetter ="R"
            }
            
        }

        //spawn generator
        function objGenerator() {
            var spawnPointWidth = Math.floor(Math.random() * canvas.width);
            var spawnPointHeight = Math.floor(Math.random() * canvas.height);

        }






    </script>
</body>

</html>